<div
  [@changeMenuState]="(isSidebarOpen$ | async) ? 'shown' : 'hidden'"
  class="position ">

<app-toggle-button
  (click)="onToggleHide()"
  [isOpen]="isSidebarOpen$ | async">
</app-toggle-button>

<div class="filter-list">

  <div class="top-list-elements">
    <app-logo
       class="clickable"
      (click)="onAppReset()">
    </app-logo>
      <mat-card class="card-spacing">
        <ng-container *ngIf="selectedSearchType === null">


        <h2>How are you searching?</h2>

        <mat-list>
         <mat-list-item>
            <button (click)="onSetSearchType(searchType.DATASET)" class="block-btn" mat-raised-button>Dataset</button>
         </mat-list-item>
         <mat-list-item>
            <button (click)="onSetSearchType(searchType.LIST)" class="block-btn" mat-raised-button>List</button>
         </mat-list-item>
         <mat-list-item>
            <button (click)="onSetSearchType(searchType.MISSION)" class="block-btn" mat-raised-button>Mission</button>
         </mat-list-item>
        </mat-list>

        <mat-divider style="margin: 20px 0" [inset]="true"></mat-divider>

        <div style="margin-top: 7px; padding: 0 16px">
        <mat-accordion>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                What are these search types?
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
              <h3>Dataset Search (most common)</h3>
              <p>
                Search for products from a dataset using a area of interest and filter based
                on date, dataset, product type and other metadata parameters.
              </p>
              <h3>List Search</h3>
              <p>
                Search using a list of granule names or a list of product names.
              </p>
              <h3>Mission Search</h3>
              <p>
                Search based on a mission, need a better description for this!
              </p>
          </mat-expansion-panel>
        </mat-accordion>
        </div>
        </ng-container>

        <ng-container *ngIf="selectedSearchType !== null">
          <div class="horizontal-btn-group">
            <button (click)="onSetSearchType(searchType.DATASET)"
              [ngClass]="{'active-btn': selectedSearchType === searchType.DATASET}"
              class="horizontal-btn" mat-raised-button>
                Dataset
            </button>
            <button (click)="onSetSearchType(searchType.LIST)"
              [ngClass]="{'active-btn': selectedSearchType === searchType.LIST}"
              class="horizontal-btn" mat-raised-button>
                List
            </button>
            <button (click)="onSetSearchType(searchType.MISSION)"
              [ngClass]="{'active-btn': selectedSearchType === searchType.MISSION}"
              class="horizontal-btn" mat-raised-button>
                Mission
            </button>
          </div>
        </ng-container>
      </mat-card>
    <mat-card *ngIf="searchError$ | async as error" class="card-spacing">
      <b>Error:</b> {{error}}
    </mat-card>
  </div>

  <div class="filters-scoll">

  <mat-tab-group
    *ngIf="selectedSearchType !== null"
    [selectedIndex]="selectedTab"
    (selectedIndexChange)="onTabChange($event)"
    >
    <mat-tab label="Search">
      <ng-container *ngIf="selectedSearchType === searchType.DATASET">
        <app-platform-selector
          [platforms]="platforms$ | async"
          [selected]="selectedPlatformNames$ | async"
          (removeSelected)="onPlatformRemoved($event)"
          (addSelected)="onPlatformAdded($event)">
        </app-platform-selector>

        <app-date-selector
          [startDate]="startDate$ | async"
          [endDate]="endDate$ | async"
          [extrema]="dateRangeExtrema$ | async"
          (newStart)="onNewStartDate($event)"
          (newEnd)="onNewEndDate($event)">
        </app-date-selector>

        <app-path-selector
          (newPathStart)="onNewPathStart($event)"
          (newPathEnd)="onNewPathEnd($event)"
          (newFrameStart)="onNewFrameStart($event)"
          (newFrameEnd)="onNewFrameEnd($event)"
          (newOmitSearchPolygon)="onNewOmitGeoRegion($event)"
          [pathRange]="pathRange$ | async"
          [shouldOmitSearchPolygon]="shouldOmitSearchPolygon$ | async"
          [frameRange]="frameRange$ | async"
          [selected]="selectedPlatforms$ | async">
        </app-path-selector>

        <app-other-selector
          (newFlightDirections)="onNewFlightDirections($event)"
          (newProductTypes)="onNewProductTypes($event)"
          (newBeamModes)="onNewBeamModes($event)"
          (newPolarizations)="onNewPolarizations($event)"
          [productTypes]="platformProductTypes$ | async"
          [selected]="selectedPlatforms$ | async"
          [flightDirections]="flightDirections$ | async"
          [beamModes]="beamModes$ | async"
          [polarizations]="polarizations$ | async">
        </app-other-selector>

        <app-max-results-selector
          [maxResults]="maxResults$ | async"
          (newMaxResults)="onNewMaxResults($event)">
        </app-max-results-selector>
      </ng-container>
      <ng-container *ngIf="selectedSearchType === searchType.LIST">
        <app-list-search
          (newListSearchMode)="onNewListSearchMode($event)"
          (newListSearch)="onNewGranuleList($event)"
          [mode]="listSearchMode$ | async"
          [searchList]="searchList$ | async">
        </app-list-search>
      </ng-container>
      <ng-container *ngIf="selectedSearchType === searchType.MISSION">
        <mat-card class="card-spacing">
          <h2>Mission Component Here...</h2>
        </mat-card>
      </ng-container>
    </mat-tab>

    <ng-container *ngIf="selectedSearchType !== null">
      <div>
        {{ selectedSearchType }}
      </div>
    </ng-container>

    <ng-container *ngIf="granules$ | async as granules">
      <mat-tab
        *ngIf="granules.length > 0"
        label="Results">

        <ng-container *ngIf="selectedGranule$ | async as selected">
          <app-granule-detail
              *ngIf="!!selected"
              (newFocusedGranule)="onNewFocusedGranule($event)"
              (clearFocusedGranule)="onClearFocusedGranule($event)"
              (newQueueItem)="onNewQueueItem($event)"
              (newQueueItems)="onNewQueueItems($event)"
              [granule]="selected"
              [products]="selectedProducts$ | async">
          </app-granule-detail>
        </ng-container>

        <mat-card class="card-spacing">
          <button (click)="onOpenSpreadsheet()" mat-raised-button>Open Spreadsheet</button>
        </mat-card>

        <app-granules-list
          (newFocusedGranule)="onNewFocusedGranule($event)"
          (clearFocusedGranule)="onClearFocusedGranule($event)"
          (newSelected)="onNewGranuleSelected($event)"
          (queueGranule)="onQueueGranuleProducts($event)"
          [granules]="granules"
          [selected]="(selectedGranule$ | async)?.name">
        </app-granules-list>
      </mat-tab>
    </ng-container>

    <ng-container *ngIf="queueProducts$ | async as queue">
      <mat-tab
        *ngIf="queue.length > 0"
        label="Queue">
          <app-queue></app-queue>
      </mat-tab>
    </ng-container>

  </mat-tab-group>
  </div>
  <div *ngIf="selectedSearchType !== null && selectedTab === 0" class="bottom-list-elements">
    <app-search-bar
      (newSearch)="onNewSearch()"
      (clearSearches)="onClearSearch()"
      [isLoading]="loading$ | async">
    </app-search-bar>
  </div>
</div>
</div>
