<div class="rectangle-wrapper" *ngIf="breakpoint$ | async as breakpoint"
     [@changeMenuY]="(isResultsMenuOpen$ | async) ? 'shown' : 'hidden'"
  >

  <div
    id="result-div"
    [ngStyle]="style"
    mwlResizable
    [validateResize]="validate"
    [enableGhostResize]="true"
    [resizeSnapGrid]="{ left: 50, right: 50 }"
    (resizeEnd)="onFinalResize($event)"
    (resizing)="onResizeEnd($event)"
  >
    <div
      [class.hidden]="(isHidden$ | async) || (areNoScenes$  | async)"
      class="result-height"
    >
      <div
        class="resize-handle-top"
        mwlResizeHandle
        [resizeEdges]="{ top: true }"
      ></div>
      <div class="results-menu--background  results-menu--layout"
           fxLayout="row">

        <ng-container *ngIf="breakpoint < breakpoints.SMALL; then tabs else noTabs">
        </ng-container>

        <ng-template #noTabs>
            <!-- SCENE LIST -->
            <mat-card class="card-spacing results-menu--column force-height"
                        fxFlex="33" fxFlexFill>
                <mat-card-subtitle *ngIf="numberOfScenes$ | async as numberOfScenes" class="header">
                  <div style="display: flex; justify-content: center;">
                    <div style="margin-right: 10px;">
                      {{ numberOfScenes }} Scene{{ numberOfScenes === 1 ? '' : 's' }}
                      ({{ numberOfProducts$ | async }} of {{ formatNumber(totalResultCount$ | async) }} File{{ (numberOfProducts$ | async) === 1 ? '' : 's' }})
                    </div>
                    <div *ngIf="allProducts$ | async as products">
                      <mat-icon
                        (click)="onZoomToResults()"
                        class="clickable noselect"
                        style="margin-right: 10px;"
                        matTooltip="Zoom to results">
                        settings_overscan
                      </mat-icon>

                      <mat-icon
                        class="clickable noselect"
                        matTooltip="Add all results to queue"
                        [matMenuTriggerFor]="addAllProducts">
                        add_shopping_cart
                      </mat-icon>

                      <mat-menu #addAllProducts="matMenu">
                        <button (click)="queueAllProducts(products)" mat-menu-item>
                          Add {{ products.length }} file{{ products.length === 1 ? '' : 's'}} to queue
                        </button>
                      </mat-menu>
                    </div>
                  </div>
                </mat-card-subtitle>
                <div class="app-scene-list">
                  <app-scenes-list [resize$]="resize$">
                  </app-scenes-list>
                </div>
              </mat-card>

            <!-- SCENE DETAIL -->
            <mat-card class="card-spacing results-menu--column no-box-shadow"
                        fxFlex="34" fxFlexFill>
                <mat-card-subtitle class="header">
                  Scene Detail
                </mat-card-subtitle>
                <app-scene-detail></app-scene-detail>
              </mat-card>

            <!-- FILE LIST -->
            <mat-card class="card-spacing results-menu--column left-border-only"
                        fxFlex="33" fxFlexFill>
                <mat-card-subtitle class="header">
          <span *ngIf="selectedProducts$ | async as products; else defaultProductsHeader">
            {{ products.length || '' }} File{{ (products || []).length === 1 ? '' : 's'}}
          </span>
                  <ng-template #defaultProductsHeader>Files</ng-template>
                </mat-card-subtitle>
                <app-scene-files></app-scene-files>
              </mat-card>
        </ng-template>
        <!--  MOBILE MOBILE MOBILE  -->

        <ng-template #tabs>
          <mat-tab-group
            [(selectedIndex)]="selectedTabIdx"
            class="tab-group-mobile">
            <!-- SCENE LIST -->
            <mat-tab label="Scenes">
              <mat-card class="card-spacing results-menu--column force-height"
                        fxFlex="100" fxFlexFill>
                <mat-card-subtitle *ngIf="numberOfScenes$ | async as numberOfScenes" class="header">
                  <div style="display: flex; justify-content: center;">
                    <div style="margin-right: 10px;">
                      {{ numberOfScenes }} Scene{{ numberOfScenes === 1 ? '' : 's' }}
                      ({{ numberOfProducts$ | async }} of {{ formatNumber(totalResultCount$ | async) }} File{{ (numberOfProducts$ | async) === 1 ? '' : 's' }})
                    </div>
                    <div *ngIf="allProducts$ | async as products">
                      <mat-icon
                        (click)="onZoomToResults()"
                        class="clickable noselect"
                        style="margin-right: 10px;"
                        matTooltip="Zoom to results">
                        settings_overscan
                      </mat-icon>

                      <mat-icon
                        class="clickable noselect"
                        matTooltip="Add all results to queue"
                        [matMenuTriggerFor]="addAllProducts">
                        add_shopping_cart
                      </mat-icon>

                      <mat-menu #addAllProducts="matMenu">
                        <button (click)="queueAllProducts(products)" mat-menu-item>
                          Add {{ products.length }} file{{ products.length === 1 ? '' : 's'}} to queue
                        </button>
                      </mat-menu>
                    </div>
                  </div>
                </mat-card-subtitle>
                <mat-card-content>
                  <div class="app-scene-list">
                    <app-scenes-list [resize$]="resize$">
                    </app-scenes-list>
                  </div>
                </mat-card-content>
              </mat-card>
            </mat-tab>

            <!-- SCENE DETAIL -->
            <mat-tab label="Scene Detail & Files">
              <mat-card class="card-spacing results-menu--column no-box-shadow"
                        fxFlex="100" fxFlexFill>
                <mat-card-subtitle class="header">
                  Scene Detail /
                  <span *ngIf="selectedProducts$ | async as products; else defaultProductsHeader">
                    {{ products.length || '' }} File{{ (products || []).length === 1 ? '' : 's'}}
                  </span>
                  <ng-template #defaultProductsHeader>Files</ng-template>
                </mat-card-subtitle>
                <app-scene-detail></app-scene-detail>
                <hr>
                <app-scene-files></app-scene-files>
              </mat-card>
            </mat-tab>

          </mat-tab-group>
        </ng-template>

      </div>
    </div>
  </div>
</div>
