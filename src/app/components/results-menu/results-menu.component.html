<div class="rectangle-wrapper w100" *ngIf="breakpoint$ | async as breakpoint"
     [@changeMenuY]="(isResultsMenuOpen$ | async) ? 'shown' : 'hidden'"
  >

  <div
    id="result-div"
    [ngStyle]="style"
    mwlResizable
    [validateResize]="validate"
    [enableGhostResize]="true"
    [resizeSnapGrid]="{ left: 50, right: 50 }"
    (resizeEnd)="onFinalResize($event)"
    (resizing)="onResizeEnd($event)"
  >
    <div
      [class.hidden]="(isHidden$ | async) || (areNoScenes$  | async)"
      class="h100"
    >
      <div
        class="resize-handle-top"
        mwlResizeHandle
        [resizeEdges]="{ top: true }"
      ></div>
      <div class="results-menu--background h100 mp0"
           fxFlex fxLayout="row">

        <ng-container *ngIf="breakpoint < breakpoints.SMALL; then tabs else noTabs">
        </ng-container>

        <ng-template #noTabs>
          <!-- SCENE LIST -->
          <mat-card class="mp0" fxFlex="33" fxFlexFill>
            <mat-card-subtitle class="header">
              <app-scenes-list-header></app-scenes-list-header>
            </mat-card-subtitle>

            <div class="app-scene-list">
              <app-scenes-list [resize$]="resize$"></app-scenes-list>
            </div>
          </mat-card>

          <!-- SCENE DETAIL -->
          <mat-card class="mp0 no-box-shadow" fxFlex="34" fxFlexFill>
            <mat-card-subtitle class="header">
              Scene Detail
            </mat-card-subtitle>

            <app-scene-detail></app-scene-detail>
          </mat-card>

          <!-- FILE LIST -->
          <mat-card class="mp0 left-border-only" fxFlex="33" fxFlexFill>
            <mat-card-subtitle class="header">
              <span *ngIf="selectedProducts$ | async as products; else defaultProductsHeader">
                {{ products.length || '' }} File{{ (products || []).length === 1 ? '' : 's'}}
              </span>
              <ng-template #defaultProductsHeader>Files</ng-template>
            </mat-card-subtitle>

            <app-scene-files></app-scene-files>
          </mat-card>
        </ng-template>
        <!--  MOBILE MOBILE MOBILE  -->

        <ng-template #tabs>
          <mat-tab-group [(selectedIndex)]="selectedTabIdx"
            class="h100 w100 mat-tab-fill-height">
            <!-- SCENE LIST -->
            <mat-tab label="Scenes">
              <mat-card class="mp0" fxFlex="100" fxFlexFill>
                <mat-card-subtitle class="header">
                  <app-scenes-list-header></app-scenes-list-header>
                </mat-card-subtitle>

                <div class="app-scene-list">
                  <app-scenes-list [resize$]="resize$"></app-scenes-list>
                </div>
              </mat-card>
            </mat-tab>

            <!-- SCENE DETAIL -->
            <mat-tab label="Scene Detail & Files">
              <mat-card class="mp0 no-box-shadow" fxFlex="100" fxFlexFill>
                <mat-card-subtitle class="header">
                  Scene Detail /
                  <span *ngIf="selectedProducts$ | async as products; else defaultProductsHeader">
                    {{ products.length || '' }} File{{ (products || []).length === 1 ? '' : 's'}}
                  </span>
                  <ng-template #defaultProductsHeader>Files</ng-template>
                </mat-card-subtitle>

                <app-scene-detail></app-scene-detail>
                <hr>
                <app-scene-files></app-scene-files>
              </mat-card>
            </mat-tab>
          </mat-tab-group>
        </ng-template>
      </div>
    </div>
  </div>
</div>
