<div
  [@changeMenuY]="(isBottomMenuOpen$ | async) ? 'shown' : 'hidden'"
  [class.hidden]="(isHidden$ | async) || (areNoGranules$  | async)"
  class="position">
  <div class="toggle-button-position">
    <button (click)="onToggleMenu()"
       class="toggle-button"
      mat-flat-button>
      <span>Results</span>
      <mat-icon>
        {{ (isBottomMenuOpen$ | async) ? 'keyboard_arrow_down' : 'keyboard_arrow_up' }}
      </mat-icon>
    </button>
  </div>
  <div class="bottom-menu--background  bottom-menu--layout">
    <mat-card class="card-spacing scrollable-card bottom-menu--column">
      <mat-card-subtitle style="display: flex; justify-content: space-between" *ngIf="numberOfGranules$ | async as numberOfGranules" class="header">
        <div>
            <mat-icon (click)="selectPreviousGranule()" class="clickable noselect">
                arrow_drop_up
            </mat-icon>
            <mat-icon (click)="selectNextGranule()" class="clickable noselect">
                arrow_drop_down
            </mat-icon>
        </div>

        <div>
          {{ numberOfGranules }} Granule{{ numberOfGranules === 1 ? '' : 's' }}
        </div>

        <div *ngIf="allProducts$ | async as products">
          <mat-icon
             class="queue-all-button clickable noselect"
             matTooltip="Add all results to queue"
            [matMenuTriggerFor]="addAllProducts">
              shopping_cart
          </mat-icon>

          <mat-menu #addAllProducts="matMenu">
            <button (click)="queueAllProducts(products)" mat-menu-item>
              Add {{ products.length }} product{{ products.length === 1 ? '' : 's'}} to queue
            </button>
          </mat-menu>
        </div>
      </mat-card-subtitle>
      <app-granules-list [platform]="searchPlatform$ | async">
      </app-granules-list>
    </mat-card>

    <mat-card class="card-spacing scrollable-card bottom-menu--column">
      <mat-card-subtitle class="header">
        <span *ngIf="selectedProducts$ | async as products; else defaultProductsHeader">
          {{ products.length || '' }} Granule Product{{ (products || []).length === 1 ? '' : 's'}}
        </span>
        <ng-template #defaultProductsHeader>Granule Products</ng-template>
      </mat-card-subtitle>
      <app-products
        [products]="selectedProducts$ | async"
        [queuedProductIds]="queuedProductIds$ | async"
        (toggleQueueProduct)="onToggleQueueProduct($event)"
        ></app-products>
    </mat-card>

    <mat-card class="card-spacing bottom-menu--column">
      <mat-card-subtitle class="header">
        Granule Detail
      </mat-card-subtitle>
      <mat-card-content class="content">
        <app-granule-detail [platform]="searchPlatform$ | async">
        </app-granule-detail>
      </mat-card-content>
    </mat-card>
  </div>
</div>
