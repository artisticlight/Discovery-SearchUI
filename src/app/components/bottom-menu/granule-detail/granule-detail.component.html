<div class="detail-card" *ngIf="granule">
  <mat-card-header>
    <mat-card-title class="detail-card-header">
      <span>{{ granule.name }}</span>

      <app-copy-to-clipboard
        [value]="granule.name"
        prompt="Copy scene name"
        class="clipboard-icon"></app-copy-to-clipboard>

    </mat-card-title>
    <mat-card-subtitle>
      <a [href]="dataset.infoUrl" target="_blank" matTooltip="Dataset" class="faint-text">{{ dataset.name }}
        <span *ngIf="dataset.name === 'SMAP'">V{{ granule.name.slice(-1) }}</span>
      </a> •
      <span matTooltip="Frequency">{{ dataset.frequency }}</span>
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-actions class="action-buttons">
    <a *ngIf="prop.isRelevant(p.BASELINE_TOOL, dataset)"
       mat-raised-button color="accent" target="_blank"
       href="https://baseline.asf.alaska.edu/#/baseline?granule={{ granule.name }}">
      Baseline Tool
    </a>
    <a mat-raised-button
       target="_blank" color="accent"
       [href]="dataset.citationUrl">
      Citation
    </a>
    <button *ngIf="isGeoSearch() && prop.isRelevant(p.PATH, dataset) && prop.isRelevant(p.FRAME, dataset)"
            (click)="findSimilarGranules()"
            matTooltip="Search based on this scenes path/frame"
            mat-raised-button color="primary">
      More Like This
    </button>
  </mat-card-actions>

  <mat-card-content class="content">
    <div class="w100" fxFlex fxLayout="row" fxLayoutAlign="space-between">
      <div class="w50">
        <ul class="granule-metadata">
          <li *ngIf="prop.isRelevant(p.DATE, dataset)">
            <span class="v-mid"><b>Start Time</b> • {{ granule.metadata.date | shortDate }}</span>
            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addGranuleDateMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addGranuleDateMenu="matMenu">
              <button (click)="setStartDate()" mat-menu-item>Set as start date</button>
              <button (click)="setEndDate()" mat-menu-item>Set as end date</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.BEAM_MODE, dataset)">
            <span class="v-mid"><b>Beam Mode </b> • {{ granule.metadata.beamMode }}</span>
            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addBeamModeMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addBeamModeMenu="matMenu">
              <button (click)="setBeamMode()" mat-menu-item>Add beam mode to search</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.PATH, dataset)">
            <span class="v-mid"><b>Path </b> • {{ granule.metadata.path }}</span>
            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addPathMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addPathMenu="matMenu">
              <button (click)="setPathStart()" mat-menu-item>Set as path start</button>
              <button (click)="setPathEnd()" mat-menu-item>Set as path end</button>
              <button (click)="setPathStart(); setPathEnd();" mat-menu-item>Set as both</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.FRAME, dataset)">
            <span class="v-mid"> <b>Frame </b> • {{ granule.metadata.frame }} </span>

            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addFrameMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addFrameMenu="matMenu">
              <button (click)="setFrameStart()" mat-menu-item>Set as frame start</button>
              <button (click)="setFrameEnd()" mat-menu-item>Set as frame end</button>
              <button (click)="setFrameStart(); setFrameEnd();" mat-menu-item>Set as both</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.FLIGHT_DIRECTION, dataset)">
            <span class="v-mid"> <b>Flight Direction </b> • {{ granule.metadata.flightDirection }} </span>
            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addFlightDirectionMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addFlightDirectionMenu="matMenu">
              <button (click)="setFlightDirection()" mat-menu-item>Set flight direction</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.POLARIZATION, dataset)">
            <span class="v-mid"> <b>Polarization </b> • {{ granule.metadata.polarization }} </span>

            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addPolMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addPolMenu="matMenu">
              <button (click)="addPolarization()" mat-menu-item>Add polarization to search</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.OFF_NADIR_ANGLE, dataset)"
            class="detail-item-margin">
            <b>Off Nadir Angle </b> • {{ granule.metadata.offNadirAngle }}
          </li>

          <li *ngIf="prop.isRelevant(p.FARADAY_ROTATION, dataset)"
            class="detail-item-margin">
            <b>Faraday Rotation </b> • {{ granule.metadata.faradayRotation }}
          </li>

          <li *ngIf="prop.isRelevant(p.MISSION_NAME, dataset)"
            class="detail-item-margin">
            <span class="v-mid"> <b>Campaign Name </b> • {{ granule.metadata.missionName }} </span>

            <mat-icon *ngIf="isGeoSearch()"
              [matMenuTriggerFor]="addMissionMenu"
              class="v-mid clickable">
                add
            </mat-icon>

            <mat-menu #addMissionMenu="matMenu">
              <button (click)="addMission()" mat-menu-item>Set campaign name</button>
            </mat-menu>
          </li>

          <li *ngIf="prop.isRelevant(p.FLIGHT_LINE, dataset)"
            class="detail-item-margin">
            <b>Flight Line </b> • {{ granule.metadata.flightLine }}
          </li>

          <li *ngIf="prop.isRelevant(p.ABSOLUTE_ORBIT, dataset)"
            class="detail-item-margin">
            <b>Absolute Orbit </b> • {{ granule.metadata.absoluteOrbit }}
          </li>

          <li *ngIf="hasValue(granule.metadata.stackSize)" class="detail-item-margin">
            <b>Matching Frames </b> • {{ granule.metadata.stackSize }}
          </li>

          <li *ngIf="dataset.source as source" class="detail-item-margin">
            <a *ngIf="source.url" [href]="source.url" target="_blank"> Data courtesy of {{ dataset.source.name }}</a>
            <span *ngIf="!source.url" class="faint-text"> Data courtesy of {{ dataset.source.name }}</span>
          </li>
        </ul>

        <p *ngIf="!authService.isLoggedIn" class="faint-text">
          Accessing this data requires you to log in.
          Some datasets also require a proposal, or agreement with a
          EULA which is presented after log in.
        </p>
      </div>

      <div class="browse-container clickable w40">
        <div (click)="onOpenImage(granule);"
          class="img-container">
            <img
              class="browse-img fit-to-container clickable"
              [src]="granule.browse"
              onerror="this.src='assets/error.png'"
              alt="Sentinel1 granule browse image">
            <div class="img-overlay fit-to-container">
              <mat-icon class="overlay-icon">fullscreen</mat-icon>
            </div>
        </div>
      </div>
    </div>
  </mat-card-content>


</div>

<div *ngIf="!granule">
  <div fxFlex fxLayoutAlign="center" gdAlignColumns="center">
    <span class="faint-text">No Scene Selected</span>
  </div>
</div>
